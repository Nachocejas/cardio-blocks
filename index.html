<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cardio Blocks</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icon-192.png" />
  <link rel="stylesheet" href="style.css" />
  
</head>
<body>
  <div class="container">
    <div class="topbar">
      <div class="topbar-brand">Cardio Blocks</div>
      <div class="topbar-right">
        <!-- Interruptor de Tema -->
        <label class="theme-switch" title="Cambiar tema">
          <input id="themeSwitch" type="checkbox" onchange="toggleThemeSwitch(this)">
          <span class="slider">
            <span class="icon sun">‚òÄÔ∏è</span>
            <span class="icon moon">üåô</span>
          </span>
        </label>
      </div>
    </div>
  
    <h1 id="titulo">Cardio Blocks</h1>
    <h2 id="tituloEjercicio" class="oculto" aria-live="polite"></h2>
      
    <div id="formulario">
      <label for="nombre">Nombre del ejercicio</label>
      <input type="text" id="nombre" placeholder="Ej: Flexiones">
  
      <label for="series">N.¬∫ de series</label>
      <input type="number" id="series" placeholder="Por ejemplo: 3">
  
      <label for="serieTime">Tiempo de serie (segundos)</label>
      <input type="number" id="serieTime" placeholder="Por ejemplo: 30">
  
      <label for="descansoTime">Tiempo de descanso entre series (segundos)</label>
      <input type="number" id="descansoTime" placeholder="Por ejemplo: 15">
  
      <label for="descansoBloque">Descanso tras bloque (segundos)</label>
      <input type="number" id="descansoBloque" placeholder="Por ejemplo: 30">
  
      <button onclick="agregarBloque()">A√±adir ejercicio</button>
      <button class="iniciar" onclick="iniciarEntrenamiento()">Iniciar entrenamiento</button>

    </div>
  
    <div id="bloques"></div>
    <div id="mensaje"></div>
  
    <div id="cuenta" aria-live="polite">00</div>
  
    <div id="progressWrap">
      <div class="progress">
        <div id="progressBar" class="progress__bar"></div>
      </div>
      <div id="progressText" class="progress__text">Preparado‚Ä¶</div>
    </div>
  
    <div id="info">
      <p>‚è± Tiempo total: <span id="tiempoTotal">0</span> s</p>
      <p>‚úÖ Series completadas: <span id="seriesCompletadas">0</span></p>
    </div>
  
    <button onclick="confirmarReset()" id="btnReset" style="display:none;">Reset</button>
    <button onclick="togglePausa()" id="btnPauseResume" style="display:none;">Pausar</button>
    <button onclick="saltarCiclo()" id="btnSkip" style="display:none;">Saltar ciclo</button>
  
    <div id="seccionRutinas">
      <hr>
      <h3>Rutinas guardadas</h3>
      <input type="text" id="nombreRutina" placeholder="Nombre de la rutina">
      <button onclick="guardarComoRutina()">Guardar como rutina</button>
  
      <select id="selectRutinas" onchange="cargarRutinaSeleccionada()">
        <option value="">--Selecciona una rutina--</option>
      </select>
      <button onclick="eliminarRutina()">Eliminar rutina seleccionada</button>
    </div>
  </div>
  
  <script>
    let bloques = [];
    let bloqueActual = 0, serieActual = 0, tiempoRestante = 0;
    let timer = null, cronometroTotal = null, tiempoTotal = 0, seriesCompletadas = 0;
    let audioCtx; // contexto global
  
    // Wake Lock + estado de sesi√≥n + beforeunload
    let wakeLock = null;
    let entrenoEnCurso = false;
    async function lockScreen() { try { wakeLock = await navigator.wakeLock?.request('screen'); } catch {} }
    function unlockScreen() { try { wakeLock?.release(); } catch {} wakeLock = null; }
    document.addEventListener('visibilitychange', () => {
      if (document.visibilityState === 'visible' && wakeLock) lockScreen();
    });
    window.addEventListener('beforeunload', (e) => {
      if (entrenoEnCurso) { e.preventDefault(); e.returnValue = ''; }
    });
  
    // Atajos teclado
    window.addEventListener('keydown', (e) => {
      if (!entrenoEnCurso) return;
      const tag = (e.target.tagName || '').toLowerCase();
      if (['input','textarea','select','button'].includes(tag)) return;
      if (e.code === 'Space') { e.preventDefault(); togglePausa(); }
      if (e.code === 'ArrowRight') { e.preventDefault(); saltarCiclo(); }
    });
  
    // Estado
    let enPausa = false;
    // 'beepSerie' | 'serie' | 'beepDescanso' | 'descanso' | 'beepBloque' | 'descansoBloque'
    let faseActual = null;
    let cuentaCallback = null;
    let tiempoGuardado = 0;
    let currentOsc = null;
    let totalEtapa = 0;
  
    // ===== Vibraci√≥n (siempre activa, sin bot√≥n) =====
    function vibrar(ms = 150) {
      let ok = false;
      try {
        const dur = ms < 120 ? 150 : ms;
        if ('vibrate' in navigator) {
          ok = navigator.vibrate(dur);
          if (!ok) ok = navigator.vibrate([80, 40, 80]);
        }
      } catch (_) {}
      if (!ok) {
        const cont = document.querySelector('.container');
        if (cont) { cont.classList.remove('vib-fx'); void cont.offsetWidth; cont.classList.add('vib-fx'); }
      }
      return ok;
    }
  
    // Ta√± corto
    function sonarTa√±(durMs = 200) {
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if (audioCtx.state === 'suspended') audioCtx.resume();
      const now = audioCtx.currentTime;
      const o1 = audioCtx.createOscillator();
      const o2 = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o1.type = 'sine'; o1.frequency.value = 880;
      o2.type = 'sine'; o2.frequency.value = 1320;
      g.gain.setValueAtTime(0.0001, now);
      g.gain.linearRampToValueAtTime(0.25, now + 0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, now + durMs / 1000);
      o1.connect(g); o2.connect(g); g.connect(audioCtx.destination);
      o1.start(now); o2.start(now); o1.stop(now + durMs/1000); o2.stop(now + durMs/1000);
    }
  
    // Mostrar/ocultar t√≠tulos de marca/ejercicio
    function ocultarTituloConTa√±() {
      const t = document.getElementById('titulo');
      if (!t) return;
      sonarTa√±(200);
      t.classList.add('titulo-oculto');
      setTimeout(() => { t.style.display = 'none'; }, 250);
    }
    function mostrarTituloConTa√±() {
      const t = document.getElementById('titulo');
      if (!t) return;
      t.style.display = '';
      requestAnimationFrame(() => t.classList.remove('titulo-oculto'));
      sonarTa√±(200);
    }
    function mostrarTituloEjercicio(nombre) {
      const te = document.getElementById('tituloEjercicio');
      te.textContent = nombre || '';
      te.classList.remove('oculto');
    }
    function ocultarTituloEjercicio() {
      const te = document.getElementById('tituloEjercicio');
      te.textContent = '';
      te.classList.add('oculto');
    }
  
    // ===== Helper: UI de ‚Äúmodo entrenando‚Äù =====
    function setEntrenandoUI(on){
      document.documentElement.classList.toggle('entrenando', !!on);
    }
  
    // ===== A√±adir bloque =====
    function agregarBloque() {
      const nombre = document.getElementById('nombre').value;
      const series = parseInt(document.getElementById('series').value);
      const serieTime = parseInt(document.getElementById('serieTime').value);
      const descansoTime = parseInt(document.getElementById('descansoTime').value);
      const descansoBloque = parseInt(document.getElementById('descansoBloque').value);
  
      if (!nombre || isNaN(series) || isNaN(serieTime) || isNaN(descansoTime) || isNaN(descansoBloque)) {
        alert("Por favor, rellena todos los campos correctamente.");
        return;
      }
  
      bloques.push({ nombre, series, serieTime, descansoTime, descansoBloque });
  
      const div = document.createElement('div');
      div.className = 'bloque-item';
      div.textContent = `${nombre} - ${series}x${serieTime}s + ${descansoTime}s descanso, ${descansoBloque}s entre bloques`;
      document.getElementById('bloques').appendChild(div);
  
      limpiarCampos();
      guardarRutinas();
    }
  
    // ===== Inicio/flujo =====
    function iniciarEntrenamiento() {
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if (audioCtx.state === 'suspended') audioCtx.resume();
  
      if (bloques.length === 0) {
        alert("Agrega al menos un ejercicio.");
        return;
      }
      document.getElementById('formulario').classList.add('oculto');
      document.getElementById('bloques').classList.add('oculto');
      document.getElementById('btnReset').style.display = 'inline-block';
      document.getElementById('btnPauseResume').style.display = 'inline-block';
      document.getElementById('btnPauseResume').innerText = 'Pausar';
      document.getElementById('btnSkip').style.display = 'inline-block';
      document.getElementById('cuenta').style.display = 'block';
      document.getElementById('seccionRutinas').style.display = 'none';
  
      const wrap = document.getElementById('progressWrap');
      wrap.style.display = 'block';
      wrap.style.visibility = 'hidden';
  
      enPausa = false;
      entrenoEnCurso = true;
      lockScreen();
  
      bloqueActual = 0;
      serieActual = 0;
      tiempoTotal = 0;
      seriesCompletadas = 0;
      document.getElementById('tiempoTotal').innerText = tiempoTotal;
      document.getElementById('seriesCompletadas').innerText = seriesCompletadas;
      iniciarCronometroTotal();
  
      ocultarTituloConTa√±();
      ocultarTituloEjercicio();
  
      setEntrenandoUI(true);             // <<<<<< activar UI de entreno
      iniciarSerie();
    }
  
    function stopBeepIfAny() {
      if (currentOsc) { try { currentOsc.onended = null; currentOsc.stop(); } catch(e) {} currentOsc = null; }
    }
  
    // Beeps
    function reproducirBeepInicio(callback) {
      vibrar(150);
      faseActual = 'beepSerie';
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if (audioCtx.state === 'suspended') audioCtx.resume();
  
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      currentOsc = osc;
  
      osc.type = 'sine'; osc.frequency.value = 440;
      const now = audioCtx.currentTime;
      gain.gain.setValueAtTime(0, now);
      gain.gain.linearRampToValueAtTime(0.2, now + 0.02);
      gain.gain.setValueAtTime(0.2, now + 3 - 0.02);
      gain.gain.linearRampToValueAtTime(0, now + 3);
      osc.connect(gain); gain.connect(audioCtx.destination);
      osc.start(now); osc.stop(now + 3);
      osc.onended = () => { currentOsc = null; if (!enPausa && typeof callback === 'function') callback(); };
      ocultarBarra();
    }
  
    function reproducirBeepDescanso(callback) {
      vibrar(150);
      faseActual = 'beepDescanso';
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if (audioCtx.state === 'suspended') audioCtx.resume();
  
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      currentOsc = osc;
  
      osc.type = 'sine'; osc.frequency.value = 440;
      const now = audioCtx.currentTime;
      gain.gain.setValueAtTime(0, now);
      gain.gain.linearRampToValueAtTime(0.2, now + 0.02);
      gain.gain.setValueAtTime(0.2, now + 1 - 0.02);
      gain.gain.linearRampToValueAtTime(0, now + 1);
      osc.connect(gain); gain.connect(audioCtx.destination);
      osc.start(now); osc.stop(now + 1);
      osc.onended = () => { currentOsc = null; if (!enPausa && typeof callback === 'function') callback(); };
      ocultarBarra();
    }
  
    function reproducirBeepDescansoBloque(callback) {
      vibrar(150);
      faseActual = 'beepBloque';
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if (audioCtx.state === 'suspended') audioCtx.resume();
  
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      currentOsc = osc;
  
      osc.type = 'square'; osc.frequency.value = 660;
      const now = audioCtx.currentTime;
      gain.gain.setValueAtTime(0, now);
      gain.gain.linearRampToValueAtTime(0.2, now + 0.02);
      gain.gain.setValueAtTime(0.2, now + 1 - 0.02);
      gain.gain.linearRampToValueAtTime(0, now + 1);
      osc.connect(gain); gain.connect(audioCtx.destination);
      osc.start(now); osc.stop(now + 1);
      osc.onended = () => { currentOsc = null; if (!enPausa && typeof callback === 'function') callback(); };
      ocultarBarra();
    }
  
    // Flujo
    function iniciarSerie() {
      const bloque = bloques[bloqueActual];
      if (serieActual < bloque.series) {
        serieActual++;
        mostrarTituloEjercicio(bloque.nombre);
        reproducirBeepInicio(() => {
          cuentaAtras(bloque.serieTime, iniciarDescanso, 'serie');
        });
      } else {
        iniciarDescansoBloque();
      }
    }
  
    function iniciarDescanso() {
      const bloque = bloques[bloqueActual];
      seriesCompletadas++;
      document.getElementById('seriesCompletadas').innerText = seriesCompletadas;
      mostrarTituloEjercicio(`Descanso ‚Äî ${bloque.nombre}`);
      reproducirBeepDescanso(() => {
        cuentaAtras(bloque.descansoTime, iniciarSerie, 'descanso');
      });
    }
  
    function iniciarDescansoBloque() {
      mostrarTituloEjercicio(`Descanso entre bloques`);
      const bloque = bloques[bloqueActual];
      reproducirBeepDescansoBloque(() => {
        cuentaAtras(bloque.descansoBloque, () => {
          bloqueActual++;
          serieActual = 0;
          if (bloqueActual < bloques.length) {
            iniciarSerie();
          } else {
            finalizarEntrenamiento();
          }
        }, 'descansoBloque');
      });
    }
  
    // Temporizador preciso
    function cuentaAtras(segundos, callback, etapa) {
      faseActual = etapa || faseActual || null;
      totalEtapa = segundos;
      cuentaCallback = callback;
  
      mostrarBarra(faseActual || 'Cuenta', totalEtapa);
  
      const end = Date.now() + segundos * 1000;
      if (timer) clearInterval(timer);
  
      const tick = () => {
        const ms = end - Date.now();
        tiempoRestante = Math.max(0, Math.ceil(ms / 1000));
        actualizarCuenta();
        actualizarProgreso();
  
        if (ms <= 0) {
          clearInterval(timer);
          const bar = document.getElementById('progressBar');
          const txt = document.getElementById('progressText');
          bar.style.transform = 'scaleX(1)';
          txt.innerText = `${nombreEtapa(faseActual)}: ${totalEtapa}/${totalEtapa}s`;
          setTimeout(() => callback(), 220);
        }
      };
  
      tick();
      timer = setInterval(tick, 200);
    }
  
    function actualizarCuenta() {
      const cuentaDiv = document.getElementById('cuenta');
      cuentaDiv.innerText = tiempoRestante;
      cuentaDiv.classList.add('animar');
      setTimeout(() => cuentaDiv.classList.remove('animar'), 200);
    }
  
    function nombreEtapa(etapa) {
      switch (etapa) {
        case 'serie': return 'Serie';
        case 'descanso': return 'Descanso';
        case 'descansoBloque': return 'Descanso entre bloques';
        default: return 'Cuenta';
      }
    }
  
    function estiloBarraPorEtapa(etapa) {
      const bar = document.getElementById('progressBar');
      if (etapa === 'serie') bar.style.background = '#28a745';
      else if (etapa === 'descanso') bar.style.background = '#ff9800';
      else if (etapa === 'descansoBloque') bar.style.background = '#6f42c1';
      else bar.style.background = '#007BFF';
    }
  
    function mostrarBarra(etapa, total) {
      const wrap = document.getElementById('progressWrap');
      const bar  = document.getElementById('progressBar');
      const txt  = document.getElementById('progressText');
      wrap.style.display = 'block';
      wrap.style.visibility = 'hidden';
      bar.style.transition = 'none';
      bar.style.transform  = 'scaleX(0)';
      estiloBarraPorEtapa(etapa);
      txt.innerText = `${nombreEtapa(etapa)}: 0/${total}s`;
      void bar.offsetWidth; // reflow
      requestAnimationFrame(() => {
        bar.style.transition = 'transform 0.2s linear';
        wrap.style.visibility = 'visible';
      });
    }
  
    function ocultarBarra() {
      const wrap = document.getElementById('progressWrap');
      wrap.style.visibility = 'hidden'; // reserva espacio
    }
  
    function actualizarProgreso() {
      const bar = document.getElementById('progressBar');
      const txt = document.getElementById('progressText');
      if (totalEtapa <= 0 || document.getElementById('progressWrap').style.display === 'none') return;
      const transcurrido = Math.max(0, totalEtapa - tiempoRestante);
      const ratio = Math.min(1, Math.max(0, transcurrido / totalEtapa));
      bar.style.transform = `scaleX(${ratio})`;
      txt.innerText = `${nombreEtapa(faseActual)}: ${transcurrido}/${totalEtapa}s`;
    }
  
    // Pausar / Reanudar
    function togglePausa() {
      const btn = document.getElementById('btnPauseResume');
      if (!enPausa) {
        enPausa = true; btn.innerText = 'Reanudar';
        if (timer) { clearInterval(timer); timer = null; tiempoGuardado = tiempoRestante; }
        stopBeepIfAny();
      } else {
        enPausa = false; btn.innerText = 'Pausar';
        const bloque = bloques[bloqueActual];
        if (faseActual === 'beepSerie') {
          reproducirBeepInicio(() => cuentaAtras(bloque.serieTime, iniciarDescanso, 'serie'));
        } else if (faseActual === 'beepDescanso') {
          reproducirBeepDescanso(() => cuentaAtras(bloque.descansoTime, iniciarSerie, 'descanso'));
        } else if (faseActual === 'beepBloque') {
          reproducirBeepDescansoBloque(() => cuentaAtras(bloque.descansoBloque, () => {
            bloqueActual++; serieActual = 0; (bloqueActual < bloques.length) ? iniciarSerie() : finalizarEntrenamiento();
          }, 'descansoBloque'));
        } else {
          if (tiempoGuardado > 0 && cuentaCallback) cuentaAtras(tiempoGuardado, cuentaCallback, faseActual);
        }
      }
    }
  
    // Saltar ciclo
    function saltarCiclo() {
      if (timer) { clearInterval(timer); timer = null; }
      stopBeepIfAny();
      enPausa = false;
  
      const bloque = bloques[bloqueActual];
      switch (faseActual) {
        case 'beepSerie':
          cuentaAtras(bloque.serieTime, iniciarDescanso, 'serie'); break;
        case 'serie':
          iniciarDescanso(); break;
        case 'beepDescanso':
          cuentaAtras(bloque.descansoTime, iniciarSerie, 'descanso'); break;
        case 'descanso':
          iniciarSerie(); break;
        case 'beepBloque':
          cuentaAtras(bloque.descansoBloque, () => {
            bloqueActual++; serieActual = 0;
            (bloqueActual < bloques.length) ? iniciarSerie() : finalizarEntrenamiento();
          }, 'descansoBloque'); break;
        case 'descansoBloque':
          bloqueActual++; serieActual = 0;
          (bloqueActual < bloques.length) ? iniciarSerie() : finalizarEntrenamiento(); break;
        default: iniciarSerie(); break;
      }
    }
  
    function finalizarEntrenamiento() {
      clearInterval(timer); clearInterval(cronometroTotal); stopBeepIfAny();
      enPausa = false; entrenoEnCurso = false; unlockScreen();
  
      document.getElementById('cuenta').innerText = "00";
      document.getElementById('btnReset').style.display = 'none';
      document.getElementById('btnPauseResume').style.display = 'none';
      document.getElementById('btnSkip').style.display = 'none';
      document.getElementById('formulario').classList.remove('oculto');
      document.getElementById('bloques').classList.remove('oculto');
      document.getElementById('bloques').innerHTML = '';
      document.getElementById('cuenta').style.display = 'none';
      document.getElementById('seccionRutinas').style.display = 'block';
  
      limpiarCampos();
      bloques = [];
      guardarRutinas();
  
      ocultarBarra();
      document.getElementById('progressWrap').style.display = 'none';
  
      mostrarTituloConTa√±();
      mostrarTituloEjercicio('');
      ocultarTituloEjercicio();
  
      setEntrenandoUI(false);           // <<<<<< desactivar UI de entreno
    }
  
    function confirmarReset() {
      const ok = confirm("¬øSeguro que quieres resetear el entrenamiento? Perder√°s el progreso de esta sesi√≥n.");
      if (ok) { reiniciarEntrenamiento(); }
    }
    
    function reiniciarEntrenamiento() {
      clearInterval(timer); clearInterval(cronometroTotal); stopBeepIfAny();
      enPausa = false; entrenoEnCurso = false; unlockScreen();
  
      document.getElementById('mensaje').innerText = "";
      document.getElementById('mensaje').classList.remove('mensaje-final');
      document.getElementById('cuenta').innerText = "00";
      document.getElementById('tiempoTotal').innerText = "0";
      document.getElementById('seriesCompletadas').innerText = "0";
      document.getElementById('btnReset').style.display = 'none';
      document.getElementById('btnPauseResume').style.display = 'none';
      document.getElementById('btnSkip').style.display = 'none';
      document.getElementById('formulario').classList.remove('oculto');
      document.getElementById('bloques').classList.remove('oculto');
      document.getElementById('bloques').innerHTML = '';
      document.getElementById('cuenta').style.display = 'none';
      document.getElementById('seccionRutinas').style.display = 'block';
  
      limpiarCampos();
      bloques = [];
      guardarRutinas();
  
      ocultarBarra();
      document.getElementById('progressWrap').style.display = 'none';
  
      mostrarTituloConTa√±();
      mostrarTituloEjercicio('');
      ocultarTituloEjercicio();
  
      setEntrenandoUI(false);           // <<<<<< desactivar UI de entreno
    }
  
    function limpiarCampos() {
      document.getElementById('nombre').value = '';
      document.getElementById('series').value = '';
      document.getElementById('serieTime').value = '';
      document.getElementById('descansoTime').value = '';
      document.getElementById('descansoBloque').value = '';
    }
  
    function iniciarCronometroTotal() {
      clearInterval(cronometroTotal);
      cronometroTotal = setInterval(() => {
        if (!enPausa) {
          tiempoTotal++;
          document.getElementById('tiempoTotal').innerText = tiempoTotal;
        }
      }, 1000);
    }
  
    // Rutinas (localStorage)
    function guardarRutinas() { localStorage.setItem('rutinas', JSON.stringify(bloques)); }
    function cargarRutinas() {
      const datos = localStorage.getItem('rutinas');
      if (datos) {
        bloques = JSON.parse(datos);
        bloques.forEach(b => {
          const div = document.createElement('div');
          div.className = 'bloque-item';
          div.textContent = `${b.nombre} - ${b.series}x${b.serieTime}s + ${b.descansoTime}s descanso, ${b.descansoBloque}s entre bloques`;
          document.getElementById('bloques').appendChild(div);
        });
      }
    }
    function guardarComoRutina() {
      const nombre = document.getElementById('nombreRutina').value.trim();
      if (!nombre) { alert("Pon un nombre para la rutina."); return; }
      let rutinasGuardadas = JSON.parse(localStorage.getItem('rutinasGuardadas')) || {};
      rutinasGuardadas[nombre] = bloques;
      localStorage.setItem('rutinasGuardadas', JSON.stringify(rutinasGuardadas));
      actualizarSelectRutinas();
      alert(`Rutina "${nombre}" guardada.`);
    }
    function actualizarSelectRutinas() {
      const select = document.getElementById('selectRutinas');
      select.innerHTML = '<option value="">--Selecciona una rutina--</option>';
      const rutinas = JSON.parse(localStorage.getItem('rutinasGuardadas')) || {};
      for (const nombre in rutinas) {
        const option = document.createElement('option');
        option.value = nombre; option.textContent = nombre; select.appendChild(option);
      }
    }
    function cargarRutinaSeleccionada() {
      const nombre = document.getElementById('selectRutinas').value;
      if (!nombre) return;
      const rutinas = JSON.parse(localStorage.getItem('rutinasGuardadas')) || {};
      if (rutinas[nombre]) {
        bloques = rutinas[nombre];
        document.getElementById('bloques').innerHTML = '';
        bloques.forEach(b => {
          const div = document.createElement('div');
          div.className = 'bloque-item';
          div.textContent = `${b.nombre} - ${b.series}x${b.serieTime}s + ${b.descansoTime}s descanso, ${b.descansoBloque}s entre bloques`;
          document.getElementById('bloques').appendChild(div);
        });
      }
    }
    function eliminarRutina() {
      const nombre = document.getElementById('selectRutinas').value;
      if (!nombre) return;
      const rutinas = JSON.parse(localStorage.getItem('rutinasGuardadas')) || {};
      delete rutinas[nombre];
      localStorage.setItem('rutinasGuardadas', JSON.stringify(rutinas));
      actualizarSelectRutinas();
      alert(`Rutina "${nombre}" eliminada.`);
    }
  
    // Tema
    function setTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      try { localStorage.setItem('theme', theme); } catch(_) {}
      const sw = document.getElementById('themeSwitch');
      if (sw) sw.checked = (theme === 'dark');
    }
    function toggleThemeSwitch(el) { setTheme(el && el.checked ? 'dark' : 'light'); }
    function initTheme() {
      let theme = 'light';
      try {
        const saved = localStorage.getItem('theme');
        if (saved) theme = saved;
        else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) theme = 'dark';
      } catch(_) {}
      setTheme(theme);
    }
  
    window.onload = () => {
      initTheme();
      cargarRutinas();
      actualizarSelectRutinas();
    };
  
    // PWA opcional
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js').catch(()=>{});
    }
  </script>
  <script src="app.js"></script>
</body>
</html>
